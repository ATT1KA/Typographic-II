.node-card { position: relative; display: flex; flex-direction: column; min-width: 300px; width: 100%; height: 100%; border: 1px solid var(--control-border); border-radius: 10px; background: linear-gradient(180deg, color-mix(in oklab, var(--bg-elev), white 3%), var(--bg-elev) 60%); color: var(--text); box-shadow: 0 10px 30px rgba(0,0,0,0.2), inset 0 1px 2px rgba(255,255,255,0.20), inset 0 -1px 3px rgba(0,0,0,0.48); box-sizing: border-box; }
.node-connectivity { min-width: 160px; }
.node-card.selected.node-connectivity { max-width: 100%; }
.node-connectivity, .node-connectivity * { box-sizing: border-box; }
.node-connectivity { max-width: 100%; overflow: visible; }
.node-connectivity .node-head { padding: 6px 10px; }
.node-connectivity .node-title { font-size: 12px; font-weight: 700; text-transform: none; }
.node-connectivity .node-body { padding: 8px; gap: 6px; min-width: 0; max-width: 100%; overflow-x: hidden; }
.node-connectivity .node-toggle { font-size: 11px; padding: 4px 8px; border-radius: 4px; }
.node-connectivity .node-form { gap: 6px; min-width: 0; max-width: 100%; overflow-x: hidden; }
.node-connectivity .node-form label { font-size: 11px; max-width: 100%; }
.node-connectivity .node-form input, .node-connectivity .node-form textarea, .node-connectivity .node-form select { padding: 6px 8px; font-size: 11px; }
.node-connectivity .node-form textarea { white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word; width: 100%; max-width: 100%; }
.node-card.selected { border-color: color-mix(in oklab, var(--control-border), white 25%); }
.node-head { flex: 0 0 auto; padding: 10px 12px; border-bottom: 1px solid var(--control-border); display: grid; gap: 6px; border-top-left-radius: 10px; border-top-right-radius: 10px; color: var(--text); }
.node-title { font-weight: 700; line-height: 1; }
.node-sub { font-size: 12px; opacity: 0.8; }
.node-head .node-title, .node-head .node-sub { text-shadow: 0 0 2px rgba(0,0,0,0.9); }
/* Connectivity nodes: distinct chrome to differentiate from Data nodes */
.node-connectivity { border-style: dashed; }
.node-connectivity .node-head { background: linear-gradient(180deg, color-mix(in oklab, var(--bg-elev), black 8%), color-mix(in oklab, var(--bg-elev), black 18%)); }
.node-connectivity .node-title { letter-spacing: 0.2px; }
.node-connectivity .node-toggle { background: #141414; }
/* Outline header text for SCI vertical with yellow header background */
.vertical-sci .node-head .node-title,
.vertical-sci .node-head .node-sub {
  /* Sci-specific: use black fill with a soft white outer glow for contrast on yellow headers */
  color: #000000;
  text-shadow: 0 0 2px rgba(255, 255, 255, 0.475), 0 0 6px rgba(255, 255, 255, 0.3);
  position: relative; /* ensure pseudo-elements position relative to text */
  pointer-events: auto; /* ensure the actual text is clickable */

  /* Maintain a subtle light stroke so the glyph edges remain crisp against the glow */
  -webkit-text-stroke: 1px rgba(255, 255, 255, 0.32);
  paint-order: stroke fill; /* render stroke under fill for cleaner edges */
}

/* Firefox fallback */
@supports not (-webkit-text-stroke: 1px black) {
  .vertical-sci .node-head .node-title,
  .vertical-sci .node-head .node-sub {
    /* Outer glow + soft inner halo to mimic stroke (fallback for browsers without text-stroke) */
    text-shadow:
      0 0 2px rgba(255, 255, 255, 0.475),
      0 0 1.5px rgba(255, 255, 255, 0.15);
  }
}

/* Prevent decorative pseudo-elements from intercepting clicks */
.vertical-sci .node-head .node-title::before,
.vertical-sci .node-head .node-title::after,
.vertical-sci .node-head .node-sub::before,
.vertical-sci .node-head .node-sub::after {
  pointer-events: none;
}

/* Ensure summary-like titles and their decorations don't block clicks when used in rail */
.vertical-sci .node-head .node-title,
.vertical-sci .node-head .node-sub {
  isolation: isolate; /* keep pseudo-elements from creating a new stacking context over other UI */
}
.node-body { flex: 1 1 auto; padding: 12px; overflow: auto; display: grid; gap: 10px; }
.node-toggle { font-size: 12px; padding: 6px 10px; border-radius: 3px; border: 1px solid var(--control-border); background: var(--control-bg); color: var(--muted); }
.node-toggle:hover { color: var(--text); }

/* Replace global focus ring (purple) for this toggle with a slim off-white outline */
.node-toggle:focus, .node-toggle:focus-visible {
  outline: 1px solid rgba(248,248,245,0.95) !important;
  outline-offset: 1px !important;
  box-shadow: none !important;
}

/* Even stronger: target when parent is focused-within (handles keyboard+mouse) */
.node-toggle:focus, .node-toggle:focus-visible, .node-card .node-toggle:focus, .node-card:focus-within .node-toggle {
  outline: none !important;
  outline-offset: 0 !important;
  box-shadow: none !important;
}

/* Ensure pressed/active state is also overridden (removes purple on mousedown) */
.node-toggle:active, .node-toggle:active:focus, .node-toggle:active:focus-visible, .node-card .node-toggle:active {
  outline: 1px solid rgba(248,248,245,0.95) !important;
  outline-offset: 1px !important;
  box-shadow: none !important;
}

/* Firefox inner focus reset */
.node-toggle::-moz-focus-inner { border: 0; }

/* make toggle positioned so pseudo-element overrides can be added if needed */
.node-toggle { position: relative; z-index: 0; }

/* Fallback overlay: draw a thin off-white ring above any existing glow
   This covers inline box-shadows or JS-applied glows that were not overridden. */
.node-toggle::after {
  /* keep pseudo-element but keep it hidden to avoid interfering */
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 12px;
  pointer-events: none;
  opacity: 0 !important;
  transition: none !important;
  z-index: -1; /* behind the button */
  display: none;
}

/* Aggressively remove any external purple glows applied to ancestors or pseudo-elements */
.node-card:focus-within, .node-card:focus-within * {
  box-shadow: none !important;
  outline: none !important;
}

/* Also target common pseudo-elements on the card that might carry glows */
.node-card:focus-within::before, .node-card:focus-within::after,
.node-card:focus-within *::before, .node-card:focus-within *::after {
  box-shadow: none !important;
  outline: none !important;
  background: transparent !important;
}

/* Custom scrollbars for node modal and rail panel */
.node-body, .node-form, .rail-panel {
  scrollbar-color: rgba(60,60,60,0.7) rgba(20,20,20,0.35); /* thumb track for Firefox */
  scrollbar-width: thin;
}

/* WebKit browsers */
.node-body::-webkit-scrollbar, .node-form::-webkit-scrollbar, .rail-panel::-webkit-scrollbar {
  width: 15px;
  height: 15px;
}
.node-body::-webkit-scrollbar-track, .node-form::-webkit-scrollbar-track, .rail-panel::-webkit-scrollbar-track {
  background: rgba(20,20,20,0.45); /* darker translucent track */
  border-radius: 3px;
}
.node-body::-webkit-scrollbar-thumb, .node-form::-webkit-scrollbar-thumb, .rail-panel::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, rgba(36,36,36,0.95), rgba(28,28,28,0.92));
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 6px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.45) inset, 0 1px 0 rgba(255,255,255,0.02);
  backdrop-filter: blur(6px) saturate(120%);
  -webkit-backdrop-filter: blur(6px) saturate(120%);
}
.node-body::-webkit-scrollbar-thumb:hover, .node-form::-webkit-scrollbar-thumb:hover, .rail-panel::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, rgba(46,46,46,0.98), rgba(32,32,32,0.96));
}
.node-form { display: grid; gap: 10px; }
.node-form label { font-size: 12px; color: var(--muted); display: grid; gap: 6px; }
.node-form input, .node-form textarea, .node-form select { width: 100%; box-sizing: border-box; background: var(--control-bg); color: var(--text); border: 1px solid var(--control-border); border-radius: 3px; padding: 8px 10px; }
.node-form textarea { min-height: 60px; resize: none; }

/* Resize handles */
.react-flow__resize-control.handle { background: #1f1f1f; border: 1px solid #3a3a3a; }

/* Override: reduce decorative outline thickness and switch color to off-white
   The UI uses a glowing/padded outline for certain node controls (previously purple).
   This rule halves the visual thickness and applies a soft off-white glow. */
.node-outline, .control-outline, .node-card:focus-within::after {
  /* previous visual size was ~4px; reduce to ~2px for a slimmer look */
  box-shadow: 0 0 0 2px rgba(248,248,245,0.95);
  outline: none;
}

/* Port tooltips: uniform, professional, hover-only */
.node-port { position: absolute; width: 7px; height: 7px; border-radius: 50%; display: block; z-index: 1; transition: box-shadow 200ms ease, transform 160ms ease; }
.node-port.react-flow__handle { width: 7px; height: 7px; }
.node-port[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  left: calc(100% + 6px);
  top: 0;
  transform: translateY(-50%);
  opacity: 0;
  pointer-events: none;
  background: rgba(18,18,18,0.95);
  color: #f2f2f2;
  padding: 4px 8px;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  white-space: nowrap;
  font-size: 11px;
  line-height: 1.1;
  transition: opacity 120ms ease, transform 120ms ease;
  z-index: 20;
}
.node-port[data-tooltip]:hover::after {
  opacity: 1;
  transform: translateY(-50%) translateX(2px);
}

/* Ensure left/right handles stay attached to the node edges with uniform spacing */
.react-flow__handle-left.node-port { left: -4px !important; }
.react-flow__handle-right.node-port { right: -4px !important; }

/* Make handles appear half-hidden behind the node for a sleeker look */
.node-card { position: relative; z-index: 2; }
.node-port { transform: translateZ(0); }

/* Connected handles get a faint 2px glow matching their kind */
.node-port.connected { transform: scale(1.08); }
/* Heartbeat-like pulse: quick double-beat then rest (non-linear feel) */
@keyframes node-port-pulse {
  /* small initial beat */
  0%   { transform: translate(-50%, -50%) scale(0.90); opacity: 0.88; }
  6%   { transform: translate(-50%, -50%) scale(1.18); opacity: 1; }
  12%  { transform: translate(-50%, -50%) scale(0.94); opacity: 0.92; }
  /* second softer beat */
  22%  { transform: translate(-50%, -50%) scale(1.08); opacity: 0.98; }
  30%  { transform: translate(-50%, -50%) scale(0.96); opacity: 0.93; }
  /* decay to resting subtle pulse */
  60%  { transform: translate(-50%, -50%) scale(1.02); opacity: 0.95; }
  100% { transform: translate(-50%, -50%) scale(0.90); opacity: 0.90; }
}

.node-port.connected::before {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 12px;
  height: 12px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 0;
  opacity: 0.95;
  transition: opacity 200ms ease, transform 160ms ease;
}
.node-port.connected.node-port--data::before {
  background: radial-gradient(circle at 40% 35%, rgba(154,154,154,0.62) 0%, rgba(154,154,154,0.36) 22%, rgba(154,154,154,0.18) 44%, rgba(154,154,154,0.06) 72%, rgba(154,154,154,0) 100%);
  /* simple pulse, 20% slower than base 1200ms → 1440ms */
  animation: node-port-simple 1440ms ease-in-out infinite;
}
.node-port.connected.node-port--meta::before {
  background: radial-gradient(circle at 40% 35%, rgba(224,85,85,0.62) 0%, rgba(235,95,74,0.44) 22%, rgba(245,110,82,0.28) 44%, rgba(235,95,74,0.08) 72%, rgba(224,85,85,0) 100%);
  /* Heartbeat animation retained for meta ports */
  animation: node-port-pulse 1560ms cubic-bezier(.25,.1,.25,1) infinite;
}
/* Ensure the actual port sits above the glow */
.node-port { z-index: 2; }

/* Prevent pseudo-elements from affecting layout or accidentally capturing events */
.node-port::after { pointer-events: none; }
